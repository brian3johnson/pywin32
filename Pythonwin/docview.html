
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Documents and Views in Pythonwin &#8212; pywin32 305 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pythonwin’s architecture" href="architecture.html" />
    <link rel="prev" title="Embedding Pythonwin" href="embeddingwin32ui.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="logo-documents-and-views-in-pythonwin">
<h1><img alt="Pythonwin logo" src="../_images/pythonwin.gif" /> Documents and Views in Pythonwin<a class="headerlink" href="#logo-documents-and-views-in-pythonwin" title="Permalink to this heading">¶</a></h1>
<div class="admonition-existing-document admonition">
<p class="admonition-title">Existing document</p>
<p><code class="file docutils literal notranslate"><span class="pre">\Pythonwin\doc\docview.html</span></code></p>
</div>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#document-and-view-control-flow" id="id3">Document and View - Control Flow</a></p></li>
<li><p><a class="reference internal" href="#object-oriented-documents" id="id4">Object Oriented Documents</a></p></li>
<li><p><a class="reference internal" href="#standard-virtual-function-specification" id="id5">Standard virtual function specification</a></p></li>
</ul>
</nav>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>see also samples index and add links inline below where referenced</p>
<p>Replace code roles with link to apidocs.</p>
<p>Replace file roles with links to file on github?</p>
</div>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>This document describes the document/view architecture of <strong class="program">Pythonwin</strong>. It is assumed you have read the <strong class="program">Pythonwin</strong> architecture documentation and are somewhat familiar with the standard MFC architecture.</p>
<p>Wherever possible, <strong class="program">Pythonwin</strong> and the samples have followed the same architecture as MFC. This has advantages and disadvantages. Often the MFC architecture does not seem to fit with small, short GUI utilities, due to the reliance on “document” based applications. On the positive, <strong class="program">Pythonwin</strong> can leverage off the full MFC functionality. This means minimal code to get full-blown application support.</p>
</section>
<section id="document-and-view-control-flow">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Document and View - Control Flow</a><a class="headerlink" href="#document-and-view-control-flow" title="Permalink to this heading">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This needs lots more work. There where 2 flow-charts, which were semi-useless!</p>
</div>
<p>The creation of the frame and views are typically done via the <code class="code docutils literal notranslate"><span class="pre">PyCWnd.LoadFrame</span></code> method. During this call, the windows are created, and virtual functions pass control back to Python. The LoadFrame flow is shown in the separate diagram.</p>
</section>
<section id="object-oriented-documents">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Object Oriented Documents</a><a class="headerlink" href="#object-oriented-documents" title="Permalink to this heading">¶</a></h2>
<p>Sam Rushing once asked me “there needs to be a way to create ‘object-oriented’ documents, by that I mean a document with an object associated with it rather than a string. Currently the only way to open a document forces you to use a string (or <code class="code docutils literal notranslate"><span class="pre">None</span></code>).”</p>
<p>The most obvious path to take would seem to override <code class="code docutils literal notranslate"><span class="pre">OpenDocumentFile</span></code> or some such, and pass an object rather than a file name. The document could then load itself from the object, and all would be happy. Unfortunately, the tight integration with MFC means this can not work, and led to Sam’s frustration above.</p>
<p>On the other hand, the <code class="code docutils literal notranslate"><span class="pre">OpenDocumentFile</span></code> method is provided for integration with a standard MDI interface, and the Windows explorer. Obviously, it is not possible to select “File/Open”, and load an object based document.</p>
<p>However, I didn’t have an easy answer for him.</p>
<section id="mfc-s-ole-implementation">
<h3>MFC’s OLE Implementation<a class="headerlink" href="#mfc-s-ole-implementation" title="Permalink to this heading">¶</a></h3>
<p>The closest example to the “right” way to do it seemed to be the MFC OLE implementation. When you have an object embedded in another document, and the user wants to edit the object, MFC must load the object without a simple “file name” parameter. MFC’s approach is this:</p>
<ul class="simple">
<li><p>A normal blank document is created (via <code class="code docutils literal notranslate"><span class="pre">OnNewDocument</span></code>)</p></li>
<li><p>COLEServerDoc’s OLE <code class="code docutils literal notranslate"><span class="pre">XPersistStorage::Load()`</span></code> method is called, with an “object” (the OLE storage pointer)</p></li>
<li><dl class="simple">
<dt>The Documents <code class="code docutils literal notranslate"><span class="pre">OnOpenEmbedding()</span></code> method is called.</dt><dd><ul>
<li><p><code class="code docutils literal notranslate"><span class="pre">OnOpenDocument</span></code> is called, with a <code class="code docutils literal notranslate"><span class="pre">NULL</span></code> file name parameter.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Serialize</span></code> is called.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Instead of changing the meaning of the existing functions, MFC adds new definitions for derived classes, such as <code class="code docutils literal notranslate"><span class="pre">OnOpenEmbedding</span></code>.</p>
</section>
<section id="back-to-our-example">
<h3>Back to our example<a class="headerlink" href="#back-to-our-example" title="Permalink to this heading">¶</a></h3>
<p>The cleanest thing seems to be to duplicate the functionality of <code class="code docutils literal notranslate"><span class="pre">OpenDocumentFile</span></code> - such as <code class="code docutils literal notranslate"><span class="pre">OpenObject</span></code>. You would do this by:</p>
<ul class="simple">
<li><p>Check to see if there is already a document representing the document open. If so, switch to it and <kbd class="kbd docutils literal notranslate">return</kbd>.</p></li>
<li><p>Create a new document object.</p></li>
<li><p>Create a frame for the document</p></li>
<li><p>Call <code class="code docutils literal notranslate"><span class="pre">OnNewDocument</span></code> to initialise the document.</p></li>
<li><p>Set the document’s title</p></li>
<li><p>Call <code class="code docutils literal notranslate"><span class="pre">InitialUpdateFrame</span></code> for the initial display.</p></li>
</ul>
</section>
<section id="objdoc-py">
<h3><code class="file docutils literal notranslate"><span class="pre">objdoc.py</span></code><a class="headerlink" href="#objdoc-py" title="Permalink to this heading">¶</a></h3>
<p>In the <strong class="program">Pythonwin</strong> demos directory, there is a file <code class="file docutils literal notranslate"><span class="pre">objdoc.py</span></code>.</p>
<p>This module defines a template, which has an <code class="code docutils literal notranslate"><span class="pre">OpenObject</span></code> method, and takes any Python object as an argument. If window with the object is already open, it is switched to. If not, a edit window is created, and the object’s <code class="code docutils literal notranslate"><span class="pre">__repr__</span></code> is written to the window.</p>
</section>
</section>
<section id="standard-virtual-function-specification">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Standard virtual function specification</a><a class="headerlink" href="#standard-virtual-function-specification" title="Permalink to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>I’m not sure where to stick this!</p>
</div>
<p>In general, the C++ virtual function handlers follow the same general logic. If no handler is defined, the base class is called. If a Python handler is defined, the base C++ class is not called. In the latter case, it is up to the Python programmer to ensure the base class is called if necessary. This is normally done by calling the method in the underlying <code class="code docutils literal notranslate"><span class="pre">_obj_</span></code>.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pywin32</a></h1>



<p class="blurb">Python for Windows Extensions</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mhammond&repo=pywin32&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../win32/index.html">Win32 Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../com/index.html">PythonCOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../adodbapi/index.html">ADO DB-API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isapi/index.html">ISAPI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html"> Pythonwin</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="debugger/index.html">Debugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="guienvironment.html">GUI Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="embeddingwin32ui.html"> Embedding Pythonwin</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Documents and Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="architecture.html">Pythonwin Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="contents.html">The Editor</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../SWIG/index.html">SWIG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Mark Hammond.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/Pythonwin/docview.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>