
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>MTS and Python for NT &#8212; pywin32 305 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="win32com.shell and Windows Shell Links" href="shell.html" />
    <link rel="prev" title="Python, C++, and COM" href="cpp.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><img alt="Python and COM, Blowing the rest away" src="../_images/pycom_blowing.gif" /></p>
<section id="mts-and-python-for-nt">
<h1>MTS and Python for NT<a class="headerlink" href="#mts-and-python-for-nt" title="Permalink to this heading">¶</a></h1>
<div class="admonition-existing-document admonition">
<p class="admonition-title">Existing document</p>
<p><code class="file docutils literal notranslate"><span class="pre">\com\help\mts.d</span></code></p>
</div>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#example" id="id1">Example</a></p></li>
</ul>
</nav>
<p>How to use python w/MTS on NT.</p>
<p>MTS represents microsoft’s attempt to simplify computing for a
distributed system. Where COM is all about identity, MTS manages
state.  It introduces new ideas and you’ll find corresponding
terminology like: object and state context, activity, causality. It
also represents a push towards declarative programming – where you
declare how a class can exist and the operating system provides the
services to handle that (instead of you having to deal with
it). Windows 2000 offers a further set of refinements, though what’s
documented here will hopefully be backward compatible.</p>
<p>In this example, we’ll specifically deal with a simple case that
can show the transaction monitor in use. We have an active server page
(using python of course) making calls to a python MTS component. The
component then makes simple use of ObjectContext interfaces and
decides whether or not the transaction is a success or failure.</p>
<p>To insert a python COM object into MTS, you want to register your
COM object,setup an MTS package, and then add the python component to
the package as a component that is already registered. After it is
added, do not then register the component using python, as it will
overwrite the changes MTS did. To create a package, open up the
Transaction Server Explorer from the Option Pack, go to My Computer -&gt;
Packages Installed, right click and select new and create an empty
package. From there you can call the package whatever you want and let
it run as whomever. Then open up the package you created, right click
on Components, select New Component, and finally select Import
components that are already registered, from which you highlight your
python component it provides in the list. You can also right click on
Roles in your package to create a role you can put users or groups
in. The last thing you need to do is right-click on your component in
the package, select properties, and finally transaction. Then select
the radio button next to: ‘Requires a transaction’.</p>
<p>As stated before, this example is interested in ObjectContext. The
ObjectContext interface is like a friend doing things on your
behalf. You declare what you want, and it helps you with that, always
acting as a buffer between you and the outside world. Many methods are
available from this interface: CreateInstance, SetComplete, SetAbort,
EnableCommit, DisableCommit, IsInTransaction, IsCallerInRole, etc.</p>
<p>In this example we will deal with: SetComplete and SetAbort, and
IsCallerInRole. Invoking SetComplete will tell MTS that the object is
done and it can go ahead and commit. In contrast, SetAbort means the
object is done but for whatever the transaction must roll
back. IsCallerInRole determines whether or not the client calling the object
is in the role you created that has lists of users or groups.</p>
<section id="example">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Example</a><a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>In python you setup the ObjectContext object in the following manner:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mtsobj</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="s2">&quot;MTXAS.AppServer.1&quot;</span><span class="p">)</span>
     <span class="n">mts</span><span class="o">=</span><span class="n">mtsobj</span><span class="o">.</span><span class="n">GetObjectContext</span><span class="p">()</span>
</pre></div>
</div>
<p>and can then make calls like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">mts</span><span class="o">.</span><span class="n">IsCallerInRole</span><span class="p">(</span><span class="s1">&#39;bedrock&#39;</span><span class="p">):</span>
        <span class="n">do_this</span><span class="p">()</span>
</pre></div>
</div>
<p>Below is the active server page and python object that you can
watch at work using “Transaction Statistics” in the Transaction Server
Explorer. Anything but wilma and betty will cause the aborted list to
increment. If wila or betty are supplied from the ASP, you notice
Committed increasing.</p>
<p>Here is an extremely simple python active server page that calls the mts object:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">SCRIPT</span> <span class="n">Language</span><span class="o">=</span><span class="s2">&quot;Python&quot;</span> <span class="n">RunAt</span><span class="o">=</span><span class="s2">&quot;Server&quot;</span><span class="o">&gt;</span>

<span class="kn">import</span> <span class="nn">win32com</span>
<span class="n">find_pebbles</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">dynamic</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="s2">&quot;mts1&quot;</span><span class="p">)</span>

<span class="n">a</span><span class="o">=</span><span class="n">find_pebbles</span><span class="p">(</span><span class="s1">&#39;wilma&#39;</span><span class="p">)</span>
<span class="n">Response</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

<span class="o">&lt;/</span><span class="n">SCRIPT</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Here is the mts COM object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">win32com.server.exception</span> <span class="kn">import</span> <span class="n">COMException</span>
<span class="kn">import</span> <span class="nn">win32com.server.util</span>
<span class="kn">import</span> <span class="nn">win32com.client.dynamic</span>

<span class="c1">#to generate guids use:</span>
<span class="c1">#import pythoncom</span>
<span class="c1">#print pythoncom.CreateGuid()</span>

<span class="k">class</span> <span class="nc">Mts</span><span class="p">:</span>
   <span class="c1"># COM attributes.</span>
   <span class="n">_reg_clsid_</span> <span class="o">=</span> <span class="s1">&#39;{3D094770-B73E-11D3-99FC-00902776D585}&#39;</span>
                  <span class="c1">#guid for your class in registry</span>
   <span class="n">_reg_desc_</span> <span class="o">=</span> <span class="s2">&quot;test mts functions&quot;</span>
   <span class="n">_reg_progid_</span> <span class="o">=</span> <span class="s2">&quot;mts1&quot;</span> <span class="c1">#The progid for this class</span>
   <span class="n">_reg_class_spec_</span> <span class="o">=</span> <span class="s2">&quot;mts_test.Mts&quot;</span>
                           <span class="c1">#tells Python how to create the object: filename.class</span>
   <span class="n">_public_methods_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;getkid&#39;</span> <span class="p">]</span>  <span class="c1">#names of callable methods</span>

   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">pass</span>

   <span class="k">def</span> <span class="nf">getkid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">person</span><span class="p">):</span>

      <span class="n">mtsobj</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="s2">&quot;MTXAS.AppServer.1&quot;</span><span class="p">)</span>
      <span class="n">mts</span><span class="o">=</span><span class="n">mtsobj</span><span class="o">.</span><span class="n">GetObjectContext</span><span class="p">()</span>

      <span class="k">if</span> <span class="n">mts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
         <span class="c1">#com obj -- no mts</span>
         <span class="n">result</span><span class="o">=</span><span class="s1">&#39;error: mts not available&#39;</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="c1">#mts is available</span>
         <span class="c1">#first check if they are in the right role</span>
         <span class="k">if</span> <span class="n">mts</span><span class="o">.</span><span class="n">IsCallerInRole</span><span class="p">(</span><span class="s1">&#39;bedrock&#39;</span><span class="p">):</span>
            <span class="n">moms</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wilma&#39;</span><span class="p">:</span><span class="s1">&#39;bambam&#39;</span><span class="p">,</span><span class="s1">&#39;betty&#39;</span><span class="p">:</span><span class="s1">&#39;pebbles&#39;</span><span class="p">}</span>
            <span class="n">person</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">person</span><span class="p">)</span> <span class="c1">#convert from unicode to string</span>
            <span class="k">if</span> <span class="n">moms</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">person</span><span class="p">):</span>
               <span class="n">mts</span><span class="o">.</span><span class="n">SetComplete</span><span class="p">()</span>
               <span class="n">result</span><span class="o">=</span><span class="n">moms</span><span class="p">[</span><span class="n">person</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">result</span><span class="o">=</span><span class="s1">&#39;not in bedrock&#39;</span>
               <span class="n">mts</span><span class="o">.</span><span class="n">SetAbort</span><span class="p">()</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span><span class="o">=</span><span class="s1">&#39;sorry can&#39;</span><span class="n">t</span> <span class="n">let</span> <span class="n">you</span> <span class="n">know</span><span class="s1">&#39;</span>
      <span class="k">return</span> <span class="n">result</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
   <span class="kn">import</span> <span class="nn">win32com.server.register</span>
   <span class="n">win32com</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">UseCommandLine</span><span class="p">(</span><span class="n">Mts</span><span class="p">)</span>
</pre></div>
</div>
<p>Have a great time with programming with python!</p>
<p>John Nielsen   <a class="reference external" href="mailto:nielsenjf&#37;&#52;&#48;my-deja&#46;com">nielsenjf<span>&#64;</span>my-deja<span>&#46;</span>com</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pywin32</a></h1>



<p class="blurb">Python for Windows Extensions</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mhammond&repo=pywin32&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../win32/index.html">Win32 Extensions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PythonCOM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="QuickStartClientCom.html">Client-side COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="QuickStartServerCom.html">Server-side COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="GeneratedSupport.html">Generated COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="variant.html">VARIANT</a></li>
<li class="toctree-l2"><a class="reference internal" href="package.html">win32com</a></li>
<li class="toctree-l2"><a class="reference internal" href="PythonCOM.html">Python &amp; COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">Miscellany</a></li>
<li class="toctree-l2"><a class="reference internal" href="active_directory.html">Active Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="adsi.html">ADSI &amp; Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="asp.html">ASP and Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp.html">Python, C++, and COM</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">MTS and Python for NT</a></li>
<li class="toctree-l2"><a class="reference internal" href="shell.html">win32com.shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="directsound.html">DirectSound examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="samples/index.html">Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/index.html">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../adodbapi/index.html">ADO DB-API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isapi/index.html">ISAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Pythonwin/index.html"> Pythonwin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWIG/index.html">SWIG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Mark Hammond.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/com/mts.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>