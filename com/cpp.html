
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Python, C++, and COM &#8212; pywin32 305 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MTS and Python for NT" href="mts.html" />
    <link rel="prev" title="ASP and Python" href="asp.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><img alt="Python and COM, Blowing the rest away" src="../_images/pycom_blowing.gif" /></p>
<section id="python-c-and-com">
<h1>Python, C++, and COM<a class="headerlink" href="#python-c-and-com" title="Permalink to this heading">¶</a></h1>
<div class="admonition-existing-document admonition">
<p class="admonition-title">Existing document</p>
<p><code class="file docutils literal notranslate"><span class="pre">\com\help\cpp.d</span></code></p>
</div>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#example" id="id1">Example</a></p></li>
</ul>
</nav>
<p>Python a helpful cousin to C++ COM development</p>
<p>Ever want to write your pseudo-code for C++ win32 or COM
programming and be able to have it run? In many cases python offers
just that.Python offers easy, fast development, yet is still close
enough to C++ to be recognizable. For example, compare python’s class
mechanism and exception handling. With the perspective of being a
light overview, we’ll look at some details of development of a raw C++
COM component and compare that to python development. What is
interesting to focus on, is not how their different, but how they are
similar, which is useful to leverage. For example, here’s what
abstract base classes (an idea used for COM interfaces) look like in
python and C++.</p>
<section id="example">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Example</a><a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>Abstract Base classes:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">//C++ interfaces</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IFlintstone</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="k">virtual</span><span class="w"> </span><span class="n">TellWilma</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">when</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="k">class</span><span class="w"> </span><span class="nc">IRubble</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="k">virtual</span><span class="w"> </span><span class="n">AskBetty</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">when</span><span class="p">)</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Abtract Base classes for python</span>
<span class="c1">#not as formal as C++&#39;s</span>
<span class="k">class</span> <span class="nc">IFlintstone</span><span class="p">:</span>
<span class="k">def</span> <span class="nf">TellWilma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
   <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s1">&#39;virtual function&#39;</span>
<span class="k">class</span> <span class="nc">IRubble</span><span class="p">:</span>
<span class="k">def</span> <span class="nf">AskBetty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
   <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s1">&#39;virtual function&#39;</span>
</pre></div>
</div>
<p>Also, in the Win32 world, python and C++ are very similar. You’ll
notice that if you look at some of the other win32 examples in
overviews. Python is capable of some sophisticated win32 programming
allowing you to get the problem worked out before you have to write
out the C++. For COM, like C++, python is multi-threaded and can live
in any apartment.  You even have at your disposal
PyIUnknown.QueryInterface, pythoncom.CoInitializeEx, etc. much like in
C++.. But don’t have to worry about casting, reference counts, and
such. Python has a translucent rather than black-box approach to COM.</p>
<p>Thus, in COM programming, you can quickly prototype a program, and
then if necessary, work on a C++ solution. As already mentioned, a
typical means in C++ to develop COM objects is with multiple
inheritance. You create class that inherits whatever interfaces
(abstract base classes), you want to expose.  The only disadvantage to
this is that it means that the interfaces can’t have the same function
names. These interfaces need to be defined using IDL to allow for
proxies, resove any ambiguities C++ may have, and generate type
libraries. A very simple IDL interface wouuld look like:</p>
<p>IDL interface:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="s">&quot;unknwn.idl&quot;</span><span class="w"></span>
<span class="p">[</span><span class="n">object</span><span class="p">,</span><span class="w"> </span><span class="n">uuid</span><span class="p">(</span><span class="mi">11111111-2222-3333-4444-555555555555</span><span class="p">)]</span><span class="w"></span>
<span class="n">interface</span><span class="w"> </span><span class="n">IFlintstone</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">IUnknown</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="n">HRESULT</span><span class="w"> </span><span class="nf">TellWilma</span><span class="p">([</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">when</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">interface</span><span class="w"> </span><span class="n">IRubble</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">IUnknown</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="n">HRESULT</span><span class="w"> </span><span class="nf">AskBetty</span><span class="p">([</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">when</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>After running it through the MIDL compiler, you include the header
file created by MIDL and then inherit this just as with the class
examples above. Then you define every method for each interface which
includes IUnknown, as well as IFlintstone and IRubble. At this point,
I’m ommitting some details like the metaclass which implements
IClassFactory that creates Bedrock and errorhandeling , but from this
class you can see the basic functions you’ll have to write.</p>
<p>C++ definition:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;file_from_midl.h&quot;</span><span class="cp"></span>
<span class="k">class</span><span class="w"> </span><span class="nc">BedRock</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IFlintstone</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">IRubble</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">   </span><span class="n">LONG</span><span class="w"> </span><span class="n">m_references</span><span class="p">;</span><span class="w"></span>

<span class="k">public</span><span class="o">:</span><span class="w"></span>
<span class="w">   </span><span class="n">BedRock</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_references</span><span class="p">(</span><span class="mi">0</span><span class="p">){</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// constructor</span>
<span class="w">   </span><span class="o">~</span><span class="n">BedRock</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">//destructor</span>

<span class="w">   </span><span class="c1">// IUnknown Methods not shown in their entirety</span>
<span class="w">   </span><span class="n">STDMETHODIMP</span><span class="w"> </span><span class="n">QueryInterface</span><span class="p">(</span><span class="n">REFIID</span><span class="w"> </span><span class="n">riid</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">**</span><span class="n">ppv</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">STDMETHODIMP_</span><span class="p">(</span><span class="n">ULONG</span><span class="p">)</span><span class="w"> </span><span class="n">AddRef</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">STDMETHODIMP_</span><span class="p">(</span><span class="n">ULONG</span><span class="p">)</span><span class="w"> </span><span class="n">Release</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"></span>

<span class="w">   </span><span class="c1">// IBedRock Methods</span>
<span class="w">   </span><span class="n">STDMETHODIMP</span><span class="w"> </span><span class="n">TellWilma</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">when</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">write_to_cartoon</span><span class="p">(</span><span class="n">when</span><span class="p">,</span><span class="s">&quot;Wilma!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">S_OK</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="n">STDMETHODIMP</span><span class="w"> </span><span class="n">AskBetty</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">when</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">write_to_cartoon</span><span class="p">(</span><span class="n">when</span><span class="p">,</span><span class="s">&quot;Hey uh Betty!&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">S_OK</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>
<span class="c1">//ClassFactory not shown</span>
</pre></div>
</div>
<p>How does python manage this? First of all, You do not bother to
write IUnknown and IClassFactory (python, being a dynamic language,
uses IDispatch to expose the methods you’re interested in). Which also
means there is no MIDL step you have to go through, if you change what
interfaces are going to be used. Python’s approach is for you to add
attributes to your python class, defining the necessary COM specifics.
For example, instead of defining the GUIDs in MIDL, you simply use the
_reg_clsid_ attribute to define the class’s GUID.</p>
<p>&lt;nl&gt;For the other methods, the basic idea is to create a python class
and write class attributes that will expose what methods you want for
COM. For interfaces which have native support you can include the list
of interfaces in a _com_interfaces_ attribute for your class.  And,
for all interfaces, you simply add the interface’s method calls to the
list of in the _public_methods_ class attribute. In this case, neither
IFlintstone nor IRubble have native support, so we don’t bother with
_com_interfaces_.</p>
<p>You’ll notice the python COM class object is reasonably simple, but
similar in spirit to the above.</p>
<p>Basic python COM code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">##Abtract Base classes for python</span>
<span class="k">class</span> <span class="nc">IFlintstone</span><span class="p">:</span>
<span class="k">def</span> <span class="nf">TellWilma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
   <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s1">&#39;virtual function&#39;</span>
<span class="k">class</span> <span class="nc">IRubble</span><span class="p">:</span>
<span class="k">def</span> <span class="nf">AskBetty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
   <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">,</span> <span class="s1">&#39;virtual function&#39;</span>

<span class="k">class</span> <span class="nc">BedRock</span><span class="p">(</span><span class="n">IFlintstone</span><span class="p">,</span> <span class="n">IRubble</span><span class="p">):</span> <span class="c1">#no need to use MIDL for these</span>
   <span class="n">_public_methods_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;TellWilma&#39;</span><span class="p">,</span> <span class="s1">&#39;AskBetty&#39;</span><span class="p">]</span>
   <span class="n">_reg_progid_</span> <span class="o">=</span> <span class="s2">&quot;Python.Bedrock&quot;</span>
   <span class="n">_reg_clsid_</span> <span class="o">=</span> <span class="s2">&quot;{12345678-1234-5678-1234-567812345678}&quot;</span>
   <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1">#constructur</span>
   <span class="k">pass</span> <span class="c1">#not doing anthing w/it</span>
            <span class="c1">#no need to keep track of reference counts</span>
   <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1">#destructor</span>
   <span class="k">pass</span> <span class="c1">#not much going on here either</span>
   <span class="k">def</span> <span class="nf">TellWilma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
   <span class="n">write_to_cartoon</span><span class="p">(</span><span class="n">when</span><span class="p">,</span><span class="s2">&quot;Wilma!&quot;</span><span class="p">)</span>
   <span class="k">def</span> <span class="nf">AskBetty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">when</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
   <span class="n">write_to_cartoon</span><span class="p">(</span><span class="n">when</span><span class="p">,</span><span class="s2">&quot;Hey uh Betty&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
   <span class="n">UseCommandLine</span><span class="p">(</span><span class="n">BedRock</span><span class="p">)</span>
</pre></div>
</div>
<p>Have a great time with programming with python!</p>
<p>John Nielsen   <a class="reference external" href="mailto:nielsenjf&#37;&#52;&#48;my-deja&#46;com">nielsenjf<span>&#64;</span>my-deja<span>&#46;</span>com</a></p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pywin32</a></h1>



<p class="blurb">Python for Windows Extensions</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mhammond&repo=pywin32&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../win32/index.html">Win32 Extensions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PythonCOM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="QuickStartClientCom.html">Client-side COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="QuickStartServerCom.html">Server-side COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="GeneratedSupport.html">Generated COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="variant.html">VARIANT</a></li>
<li class="toctree-l2"><a class="reference internal" href="package.html">win32com</a></li>
<li class="toctree-l2"><a class="reference internal" href="PythonCOM.html">Python &amp; COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">Miscellany</a></li>
<li class="toctree-l2"><a class="reference internal" href="active_directory.html">Active Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="adsi.html">ADSI &amp; Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="asp.html">ASP and Python</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Python, C++, and COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="mts.html">MTS and Python for NT</a></li>
<li class="toctree-l2"><a class="reference internal" href="shell.html">win32com.shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="directsound.html">DirectSound examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="samples/index.html">Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/index.html">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../adodbapi/index.html">ADO DB-API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isapi/index.html">ISAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Pythonwin/index.html"> Pythonwin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWIG/index.html">SWIG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Mark Hammond.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/com/cpp.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>