
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>win32com.client.VARIANT &#8212; pywin32 305 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The win32com package" href="package.html" />
    <link rel="prev" title="Generated Python COM Support" href="GeneratedSupport.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><img alt="Python and COM, Blowing the rest away" src="../_images/pycom_blowing.gif" /></p>
<section id="win32com-client-variant">
<h1>win32com.client.VARIANT<a class="headerlink" href="#win32com-client-variant" title="Permalink to this heading">¶</a></h1>
<div class="admonition-existing-document admonition">
<p class="admonition-title">Existing document</p>
<p><code class="file docutils literal notranslate"><span class="pre">\com\win32com\html\variant.html</span></code></p>
</div>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#drawbacks" id="id2">Drawbacks</a></p></li>
<li><p><a class="reference internal" href="#the-variant-object" id="id3">The VARIANT object</a></p></li>
<li><p><a class="reference internal" href="#example-usage-with-dynamic-objects" id="id4">Example usage with dynamic objects</a></p></li>
<li><p><a class="reference internal" href="#usage-with-generated-objects" id="id5">Usage with generated objects</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>win32com attempts to provide a seamless COM interface and hide many COM implementation details, including the use of COM VARIANT structures. This means that in most cases, you just call a COM object using normal Python objects as parameters and get back normal Python objects as results.</p>
<p>However, in some cases this doesn’t work very well, particularly when using “dynamic” (aka late-bound) objects, or when using “makepy” (aka early-bound) objects which only declare a parameter is a VARIANT.</p>
<p>The win32com.client.VARIANT object is designed to overcome these problems.</p>
</section>
<section id="drawbacks">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Drawbacks</a><a class="headerlink" href="#drawbacks" title="Permalink to this heading">¶</a></h2>
<p>The primary issue with this approach is that the programmer must learn more about COM VARIANTs than otherwise - they need to know concepts such as variants being byref, holding arrays, or that some may hold 32bit unsigned integers while others hold 64bit signed ints, and they need to understand this in the context of a single method call. In short, this is a relatively advanced feature. The good news though is that use of these objects should never cause your program to hard-crash - the worst you should expect are Python or COM exceptions being thrown.</p>
</section>
<section id="the-variant-object">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">The VARIANT object</a><a class="headerlink" href="#the-variant-object" title="Permalink to this heading">¶</a></h2>
<p>The VARIANT object lives in win32com.client. The constructor takes 2 parameters - the ‘variant type’ and the value. The ‘variant type’ is an integer and can be one or more of the pythoncom.VT_* values, possibly or’d together.</p>
<p>For example, to create a VARIANT object which defines a byref array of 32bit integers, you could use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">win32com.client</span> <span class="kn">import</span> <span class="n">VARIANT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pythoncom</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">VARIANT</span><span class="p">(</span><span class="n">pythoncom</span><span class="o">.</span><span class="n">VT_BYREF</span> <span class="o">|</span> <span class="n">pythoncom</span><span class="o">.</span><span class="n">VT_ARRAY</span> <span class="o">|</span> <span class="n">pythoncom</span><span class="o">.</span><span class="n">VT_I4</span><span class="p">,</span>
<span class="gp">... </span>            <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span>
<span class="go">win32com.client.VARIANT(24579, [1, 2, 3, 4])</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>This variable can then be used whereever a COM VARIANT is expected.</p>
</section>
<section id="example-usage-with-dynamic-objects">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Example usage with dynamic objects</a><a class="headerlink" href="#example-usage-with-dynamic-objects" title="Permalink to this heading">¶</a></h2>
<p>For this example we will use the COM object used for win32com testing, PyCOMTest.PyCOMTest. This object defines a method which is defined in IDL as:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">HRESULT</span><span class="w"> </span><span class="nf">DoubleInOutString</span><span class="p">([</span><span class="n">in</span><span class="p">,</span><span class="n">out</span><span class="p">]</span><span class="w"> </span><span class="n">BSTR</span><span class="w"> </span><span class="o">*</span><span class="n">str</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>As you can see, it takes a single string parameter which is also used as an “out” parameter - the single parameter will be updated after the call. The implementation of the method simply “doubles” the string.</p>
<p>If the object has a type-library, this method works fine with makepy generated support. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">win32com.client.gencache</span> <span class="kn">import</span> <span class="n">EnsureDispatch</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ob</span> <span class="o">=</span> <span class="n">EnsureDispatch</span><span class="p">(</span><span class="s2">&quot;PyCOMTest.PyCOMTest&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ob</span><span class="o">.</span><span class="n">DoubleInOutString</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="go">u&#39;HelloHello&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>However, if makepy support is not available the method does not work as expected. For the next example we will use DumbDispatch to simulate the object not having a type-library.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">win32com.client.dynamic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ob</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">dynamic</span><span class="o">.</span><span class="n">DumbDispatch</span><span class="p">(</span><span class="s2">&quot;PyCOMTest.PyCOMTest&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ob</span><span class="o">.</span><span class="n">DoubleInOutString</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>As you can see, no result came back from the function. This is because win32com has no type information available to use, so doesn’t know the parameter should be passed as a byref parameter. To work around this, we can use the VARIANT object.</p>
<p>The following example explicitly creates a VARIANT object with a variant type of a byref string and a value ‘Hello’. After making the call with this VARIANT the value is updated.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">win32com.client.dynamic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">win32com.client</span> <span class="kn">import</span> <span class="n">VARIANT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pythoncom</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ob</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">dynamic</span><span class="o">.</span><span class="n">DumbDispatch</span><span class="p">(</span><span class="s2">&quot;PyCOMTest.PyCOMTest&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variant</span> <span class="o">=</span> <span class="n">VARIANT</span><span class="p">(</span><span class="n">pythoncom</span><span class="o">.</span><span class="n">VT_BYREF</span> <span class="o">|</span> <span class="n">pythoncom</span><span class="o">.</span><span class="n">VT_BSTR</span><span class="p">,</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variant</span><span class="o">.</span><span class="n">value</span> <span class="c1"># check the value before the call.</span>
<span class="go">&#39;Hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ob</span><span class="o">.</span><span class="n">DoubleInOutString</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variant</span><span class="o">.</span><span class="n">value</span>
<span class="go">u&#39;HelloHello&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
</section>
<section id="usage-with-generated-objects">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Usage with generated objects</a><a class="headerlink" href="#usage-with-generated-objects" title="Permalink to this heading">¶</a></h2>
<p>In most cases, objects with makepy support (ie, ‘generated’ objects) don’t need to use the VARIANT object - the type information means win32com can guess the right thing to pass. However, in some cases the VARIANT object can still be useful. Imagine a poorly specified object with IDL like:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">HRESULT</span><span class="w"> </span><span class="nf">DoSomething</span><span class="p">([</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="n">VARIANT</span><span class="w"> </span><span class="n">value</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>But also imagine that the object has a limitation that if the parameter is an integer, it must be a 32bit unsigned value - any other integer representation will fail.</p>
<p>If you just pass a regular Python integer to this function, it will generally be passed as a 32bit signed integer and given the limitation above, will fail. The VARIANT object allows you to work around the limitation - just create a variant object VARIANT(pythoncom.VT_UI4, int_value) and pass that - the function will then be called with the explicit type you specified and will succeed.</p>
<p>Note that you can not use a VARIANT object to override the types described in a type library. If a makepy generated class specifies that a VT_UI2 is expected, attempting to pass a VARIANT object will fail. In this case you would need to hack around the problem. For example, imagine ob was a COM object which a method called foo and you wanted to override the type declaration for foo by passing a VARIANT. You could do something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">win32com.client.dynamic</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">win32com.client</span> <span class="kn">import</span> <span class="n">VARIANT</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pythoncom</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dumbob</span> <span class="o">=</span> <span class="n">win32com</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">dynamic</span><span class="o">.</span><span class="n">DumbDispatch</span><span class="p">(</span><span class="n">ob</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">variant</span> <span class="o">=</span> <span class="n">VARIANT</span><span class="p">(</span><span class="n">pythoncom</span><span class="o">.</span><span class="n">VT_BYREF</span> <span class="o">|</span> <span class="n">pythoncom</span><span class="o">.</span><span class="n">VT_BSTR</span><span class="p">,</span> <span class="s2">&quot;Hello&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dumbob</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">variant</span><span class="p">)</span>
</pre></div>
</div>
<p>The code above converts the makepy supported ob into a ‘dumb’ (ie, non-makepy supported) version of the object, which will then allow you to use VARIANT objects for the problematic methods.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pywin32</a></h1>



<p class="blurb">Python for Windows Extensions</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mhammond&repo=pywin32&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../win32/index.html">Win32 Extensions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PythonCOM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="QuickStartClientCom.html">Client-side COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="QuickStartServerCom.html">Server-side COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="GeneratedSupport.html">Generated COM</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">VARIANT</a></li>
<li class="toctree-l2"><a class="reference internal" href="package.html">win32com</a></li>
<li class="toctree-l2"><a class="reference internal" href="PythonCOM.html">Python &amp; COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">Miscellany</a></li>
<li class="toctree-l2"><a class="reference internal" href="active_directory.html">Active Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="adsi.html">ADSI &amp; Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="asp.html">ASP and Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp.html">Python, C++, and COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="mts.html">MTS and Python for NT</a></li>
<li class="toctree-l2"><a class="reference internal" href="shell.html">win32com.shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="directsound.html">DirectSound examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="samples/index.html">Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/index.html">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../adodbapi/index.html">ADO DB-API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isapi/index.html">ISAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Pythonwin/index.html"> Pythonwin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWIG/index.html">SWIG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Mark Hammond.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/com/variant.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>