
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Quick Start to Server side COM and Python &#8212; pywin32 305 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Generated Python COM Support" href="GeneratedSupport.html" />
    <link rel="prev" title="Quick Start to Client side COM and Python" href="QuickStartClientCom.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <p><img alt="Python and COM, Blowing the rest away" src="../_images/pycom_blowing.gif" /></p>
<section id="quick-start-to-server-side-com-and-python">
<h1>Quick Start to Server side COM and Python<a class="headerlink" href="#quick-start-to-server-side-com-and-python" title="Permalink to this heading">¶</a></h1>
<div class="admonition-existing-document admonition">
<p class="admonition-title">Existing document</p>
<p><code class="file docutils literal notranslate"><span class="pre">\com\win32com\html\QuickStartServerCom.html</span></code></p>
</div>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p></li>
<li><p><a class="reference internal" href="#implement-the-core-functionality" id="id2">Implement the core functionality</a></p></li>
<li><p><a class="reference internal" href="#testing-our-class" id="id3">Testing our Class</a></p></li>
<li><p><a class="reference internal" href="#debugging-the-com-server" id="id4">Debugging the COM Server</a></p></li>
<li><p><a class="reference internal" href="#exception-handling" id="id5">Exception Handling</a></p></li>
<li><p><a class="reference internal" href="#server-policies" id="id6">Server Policies</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>This documents how to quickly start implementing COM objects in Python. It is not a thorough discussion of the COM system, or of the concepts introduced by COM.</p>
<p>For more details information on Python and COM, please see the COM Tutorial given by Greg Stein and Mark Hammond at SPAM 6 (HTML format) or download the same tutorial in PowerPoint format.</p>
<p>For information on using external COM objects from Python, please see a Quick Start to Client side COM and Python.</p>
<p>In this document we discuss the core functionality, registering the server, testing the class, debugging the class, exception handling and server policies (phew!).</p>
</section>
<section id="implement-the-core-functionality">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Implement the core functionality</a><a class="headerlink" href="#implement-the-core-functionality" title="Permalink to this heading">¶</a></h2>
<section id="implement-a-stand-alone-python-class-with-your-functionality">
<h3>Implement a stand-alone Python class with your functionality<a class="headerlink" href="#implement-a-stand-alone-python-class-with-your-functionality" title="Permalink to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HelloWorld</span><span class="p">:</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="bp">self</span><span class="o">.</span><span class="n">softspace</span> <span class="o">=</span> <span class="mi">1</span>

<span class="bp">self</span><span class="o">.</span><span class="n">noCalls</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">Hello</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">who</span><span class="p">):</span>

<span class="bp">self</span><span class="o">.</span><span class="n">noCalls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noCalls</span> <span class="o">+</span> <span class="mi">1</span>

<span class="c1"># insert &quot;softspace&quot; number of spaces</span>

<span class="k">return</span> <span class="s2">&quot;Hello&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">softspace</span> <span class="o">+</span> <span class="n">who</span>
</pre></div>
</div>
<p>This is obviously a very simple server. In particular, custom error handling would be needed for a production class server. In addition, there are some contrived properties just for demonstration purposes.</p>
</section>
<section id="make-unicode-concessions">
<h3>Make Unicode concessions<a class="headerlink" href="#make-unicode-concessions" title="Permalink to this heading">¶</a></h3>
<p>At this stage, Python and Unicode don’t really work well together. All strings which come from COM will actually be Unicode objects rather than string objects.</p>
<p>To make this code work in a COM environment, the last line of the “Hello” method must become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="s2">&quot;Hello&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">softspace</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">who</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the conversion of the “who” to “str(who)”. This forces the Unicode object into a native Python string object.</p>
<p>For details on how to debug COM Servers to find this sort of error, please see debugging the class.</p>
</section>
<section id="annotate-the-class-with-win32com-specific-attributes">
<h3>Annotate the class with win32com specific attributes<a class="headerlink" href="#annotate-the-class-with-win32com-specific-attributes" title="Permalink to this heading">¶</a></h3>
<p>This is not a complete list of names, simply a list of properties used by this sample.</p>
<p>TABLE FORMATTING</p>
<p>Property Name Description</p>
<p>_public_methods_ List of all method names exposed to remote COM clients</p>
<p>_public_attrs_ List of all attribute names exposed to remote COM clients</p>
<p>_readonly_attrs_ List of all attributes which can be accessed, but not set.</p>
<p>We change the class header to become:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HelloWorld</span><span class="p">:</span>

<span class="n">_public_methods_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Hello&#39;</span><span class="p">]</span>

<span class="n">_public_attrs_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;softspace&#39;</span><span class="p">,</span> <span class="s1">&#39;noCalls&#39;</span><span class="p">]</span>

<span class="n">_readonly_attrs_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;noCalls&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="c1"># Same from here…</span>
</pre></div>
</div>
</section>
<section id="registering-and-assigning-a-clsid-for-the-object">
<h3>Registering and assigning a CLSID for the object<a class="headerlink" href="#registering-and-assigning-a-clsid-for-the-object" title="Permalink to this heading">¶</a></h3>
<p>COM requires that all objects use a unique CLSID and be registered under a “user friendly” name. This documents the process.</p>
<section id="generating-the-clsid">
<h4>Generating the CLSID<a class="headerlink" href="#generating-the-clsid" title="Permalink to this heading">¶</a></h4>
<p>Microsoft Visual C++ comes with various tools for generating CLSID’s, which are quite suitable. Alternatively, the pythoncom module exports the function CreateGuid() to generate these identifiers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pythoncom</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">pythoncom</span><span class="o">.</span><span class="n">CreateGuid</span><span class="p">()</span>
<span class="go">{7CC9F362-486D-11D1-BB48-0000E838A65F}</span>
</pre></div>
</div>
<p>Obviously the GUID that you get will be different than that displayed here.</p>
</section>
<section id="preparing-for-registration-of-the-class">
<h4>Preparing for registration of the Class<a class="headerlink" href="#preparing-for-registration-of-the-class" title="Permalink to this heading">¶</a></h4>
<p>The win32com package allows yet more annotations to be applied to a class, allowing registration to be effected with 2 lines in your source file. The registration annotations used by this sample are:</p>
<p>TABLE FORMATTING</p>
<p>Property Name Description</p>
<p>_reg_clsid_ The CLSID of the COM object</p>
<p>_reg_progid_ The “program ID”, or Name, of the COM Server. This is the name the user usually uses to instantiate the object</p>
<p>_reg_desc_ Optional: The description of the COM Server. Used primarily for COM browsers. If not specified, the _reg_progid_ is used as the description.</p>
<p>_reg_class_spec_ Optional: A string which represents how Python can create the class instance. The string is of format [package.subpackage.]module.class</p>
<p>The portion up to the class name must be valid for Python to “import”, and the class portion must be a valid attribute in the specified class.</p>
<p>This is optional from build 124 of Pythoncom., and has been removed from this sample.</p>
<p>_reg_remove_keys_ Optional: A list of tuples of extra registry keys to be removed when uninstalling the server. Each tuple is of format (“key”, root), where key is a string, and root is one of the win32con.HKEY_* constants (this item is optional, defaulting to HKEY_CLASSES_ROOT)</p>
<p>Note there are quite a few other keys available. Also note that these annotations are not required - they just make registration simple. Helper functions in the module win32com.server.register allow you to explicitly specify each of these attributes without attaching them to the class.</p>
<p>The header of our class now becomes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HelloWorld</span><span class="p">:</span>

<span class="n">_reg_clsid_</span> <span class="o">=</span> <span class="s2">&quot;{7CC9F362-486D-11D1-BB48-0000E838A65F}&quot;</span>

<span class="n">_reg_desc_</span> <span class="o">=</span> <span class="s2">&quot;Python Test COM Server&quot;</span>

<span class="n">_reg_progid_</span> <span class="o">=</span> <span class="s2">&quot;Python.TestServer&quot;</span>

<span class="n">_public_methods_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Hello&#39;</span><span class="p">]</span>

<span class="c1"># same from here</span>
</pre></div>
</div>
</section>
<section id="registering-the-class">
<h4>Registering the Class<a class="headerlink" href="#registering-the-class" title="Permalink to this heading">¶</a></h4>
<p>The idiom that most Python COM Servers use is that they register themselves when run as a script (ie, when executed from the command line.) Thus the standard “if __name__==’__main___’:” technique works well.</p>
<p>win32com.server.register contains a number of helper functions. The easiest to use is “UseCommandLine”.</p>
<p>Registration becomes as simple as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="c1"># ni only for 1.4!</span>
<span class="kn">import</span> <span class="nn">ni</span><span class="o">,</span> <span class="nn">win32com.server.register</span>
<span class="n">win32com</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">register</span><span class="o">.</span><span class="n">UseCommandLine</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">)</span>
</pre></div>
</div>
<p>Running the script will register our test server.</p>
</section>
</section>
</section>
<section id="testing-our-class">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Testing our Class</a><a class="headerlink" href="#testing-our-class" title="Permalink to this heading">¶</a></h2>
<p>For the purposes of this demonstration, we will test the class using Visual Basic. This code should run under any version of Visual Basic, including VBA found in Microsoft Office. Any COM compliant package could be used alternatively. VB has been used just to prove there is no “smoke and mirrors. For information on how to test the server using Python, please see the Quick Start to Client side COM documentation.</p>
<p>This is not a tutorial in VB. The code is just presented! Run it, and it will work!</p>
</section>
<section id="debugging-the-com-server">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Debugging the COM Server</a><a class="headerlink" href="#debugging-the-com-server" title="Permalink to this heading">¶</a></h2>
<p>When things go wrong in COM Servers, there is often nowhere useful for the Python traceback to go, even if such a traceback is generated.</p>
<p>Rather than discuss how it works, I will just present the procedure to debug your server:</p>
<p>To register a debug version of your class, run the script (as above) but pass in a “==debug” parameter. Eg, for the server above, use the command line “testcomserver.py ==debug”.</p>
<p>To see the debug output generated (and any print statements you may choose to add!) you can simply select the “Remote Debug Trace Collector” from the Pythonwin Tools menu, or run the script “win32traceutil.py” from Windows Explorer or a Command Prompt.</p>
</section>
<section id="exception-handling">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Exception Handling</a><a class="headerlink" href="#exception-handling" title="Permalink to this heading">¶</a></h2>
<p>Servers need to be able to provide exception information to their client. In some cases, it may be a simple return code (such as E_NOTIMPLEMENTED), but often it can contain much richer information, describing the error on detail, and even a help file and topic where more information can be found.</p>
<p>We use Python class based exceptions to provide this information. The COM framework will examine the exception, and look for certain known attributes. These attributes will be copied across to the COM exception, and passed back to the client.</p>
<p>The following attributes are supported, and correspond to the equivalent entry in the COM Exception structure: scode, code, description, source, helpfile, and helpcontext</p>
<p>To make working with exceptions easier, there is a helper module “win32com.server.exception.py”, which defines a single class. An example of its usage would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">raise</span> <span class="n">COMException</span><span class="p">(</span><span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Must be a string&quot;</span><span class="p">,</span><span class="n">scode</span><span class="o">=</span><span class="n">winerror</span><span class="o">.</span><span class="n">E_INVALIDARG</span><span class="p">,</span><span class="n">helpfile</span><span class="o">=</span><span class="s2">&quot;myhelp.hlp&quot;</span><span class="p">,</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>(Note the COMException class supports (and translates) “desc” as a shortcut for “description”, but the framework requires “description”)</p>
</section>
<section id="server-policies">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Server Policies</a><a class="headerlink" href="#server-policies" title="Permalink to this heading">¶</a></h2>
<p>This is information about how it all hangs together. The casual COM author need not know this.</p>
<p>Whenever a Python Server needs to be created, the C++ framework first instantiates a “policy” object. This “policy” object is the gatekeeper for the COM Server - it is responsible for creating the underlying Python object that is the server (ie, your object), and also for translating the underlying COM requests for the object.</p>
<p>This policy object handles all of the underlying COM functionality. For example, COM requires all methods and properties to have unique numeric ID’s associated with them. The policy object manages the creation of these ID’s for the underlying Python methods and attributes. Similarly, when the client whishes to call a method with ID 123, the policy object translates this back to the actual method, and makes the call.</p>
<p>It should be noted that the operation of the “policy” object could be dictated by the Python object - the policy object has many defaults, but the actual Python class can always dictate its operation.</p>
<section id="default-policy-attributes">
<h3>Default Policy attributes<a class="headerlink" href="#default-policy-attributes" title="Permalink to this heading">¶</a></h3>
<p>The default policy object has a few special attributes that define who the object is exposed to COM. The example above shows the _public_methods attribute, but this section describes all such attributes in detail.</p>
<p>_public_methods_</p>
<p>Required list of strings, containing the names of all methods to be exposed to COM. It is possible this will be enhanced in the future (eg, possibly ‘*’ will be recognised to say all methods, or some other ideas…)</p>
<p>_public_attrs_</p>
<p>Optional list of strings containing all attribute names to be exposed, both for reading and writing. The attribute names must be valid instance variables.</p>
<p>_readonly_attrs_</p>
<p>Optional list of strings defining the name of attributes exposed read-only.</p>
<p>_com_interfaces_
Optional list of IIDs exposed by this object. If this attribute is missing, IID_IDispatch is assumed (ie, if not supplied, the COM object will be created as a normal Automation object.</p>
<p>and actual instance attributes:</p>
<p>_dynamic_ : optional method</p>
<p>_value_ : optional attribute</p>
<p>_query_interface_ : optional method</p>
<p>_NewEnum : optional method</p>
<p>_Evaluate : optional method</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pywin32</a></h1>



<p class="blurb">Python for Windows Extensions</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mhammond&repo=pywin32&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gettingstarted.html">Getting Started Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../win32/index.html">Win32 Extensions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">PythonCOM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="QuickStartClientCom.html">Client-side COM</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Server-side COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="GeneratedSupport.html">Generated COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="variant.html">VARIANT</a></li>
<li class="toctree-l2"><a class="reference internal" href="package.html">win32com</a></li>
<li class="toctree-l2"><a class="reference internal" href="PythonCOM.html">Python &amp; COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">Miscellany</a></li>
<li class="toctree-l2"><a class="reference internal" href="active_directory.html">Active Directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="adsi.html">ADSI &amp; Exchange</a></li>
<li class="toctree-l2"><a class="reference internal" href="asp.html">ASP and Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp.html">Python, C++, and COM</a></li>
<li class="toctree-l2"><a class="reference internal" href="mts.html">MTS and Python for NT</a></li>
<li class="toctree-l2"><a class="reference internal" href="shell.html">win32com.shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="directsound.html">DirectSound examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="samples/index.html">Samples</a></li>
<li class="toctree-l2"><a class="reference internal" href="apidoc/index.html">API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../adodbapi/index.html">ADO DB-API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isapi/index.html">ISAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Pythonwin/index.html"> Pythonwin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../SWIG/index.html">SWIG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Mark Hammond.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/com/QuickStartServerCom.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>